      - name: Commit and Push Scanner Report to `Scanner_Reports` Branch
        if: always()
        shell: bash
        run: |
          set -euo pipefail

          # If report doesn't exist, create a tiny placeholder (so commit step never breaks)
          if [[ ! -s scanner-report.csv ]]; then
            echo "‚ö†Ô∏è scanner-report.csv missing or empty. Creating placeholder."
            echo "rule,engine,severity,tags,file,startLine,startColumn,endLine,endColumn,message,resources,CommitAuthor,ActualLine,TargetBranch" > scanner-report.csv
          fi

          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

          BRANCH_NAME="Scanner_Reports"
          echo "‚úÖ Target Branch: $BRANCH_NAME"

          # Make sure we can switch branches without losing generated files
          git stash push --include-untracked -m "stash scanner report" || true

          # Ensure branch exists
          if git ls-remote --exit-code --heads origin "$BRANCH_NAME"; then
            echo "‚úÖ Remote branch $BRANCH_NAME exists."
            git fetch origin "$BRANCH_NAME":"$BRANCH_NAME"
            git checkout "$BRANCH_NAME"
          else
            echo "‚ùå Remote branch $BRANCH_NAME does not exist. Creating it..."
            git checkout -b "$BRANCH_NAME"
            git push --set-upstream origin "$BRANCH_NAME"
          fi

          git pull origin "$BRANCH_NAME" --rebase || true

          # Restore scanner report from stash
          git stash pop || true

          mkdir -p Artifact
          OUTFILE="Artifact/scanner-report-pr-${{ github.event.pull_request.number }}-run-${{ github.run_id }}.csv"
          cp scanner-report.csv "$OUTFILE"

          git add "$OUTFILE"
          git commit -m "üîÑ Add scanner report (PR #${{ github.event.pull_request.number }}, run ${{ github.run_id }})" || echo "No changes to commit"
          git push origin "$BRANCH_NAME"
        env:
          GH_PAT: ${{ secrets.GH_PAT }}
