- name: Upload coverage.csv file to Salesforce via REST API
  run: |
    echo "Uploading coverage.csv to Salesforce..."

    FILE="force-app/main/default/lwc/tmpLwcComponent/test/coverage.csv"
    FILE_NAME="CoverageReport.csv"

    # Get access token and instance URL from the default authenticated org (arpoc2)
    ACCESS_TOKEN=$(sf org display --target-org arpoc2 --json | jq -r '.result.accessToken')
    INSTANCE_URL=$(sf org display --target-org arpoc2 --json | jq -r '.result.instanceUrl')

    # Encode the file in base64 for VersionData
    FILE_CONTENT=$(base64 "$FILE" | tr -d '\n')

    # Call Salesforce REST API to upload ContentVersion
    response=$(curl -s -X POST "$INSTANCE_URL/services/data/v60.0/sobjects/ContentVersion" \
      -H "Authorization: Bearer $ACCESS_TOKEN" \
      -H "Content-Type: application/json" \
      -d @<(cat <<EOF
{
  "Title": "$FILE_NAME",
  "PathOnClient": "$FILE_NAME",
  "VersionData": "$FILE_CONTENT"
}
EOF
))

    echo "Salesforce Upload Response:"
    echo "$response"
