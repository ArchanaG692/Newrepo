#!/bin/bash

# Input: test-result.xml
# Output: CSV with columns: ClassName, MethodName, Time, Status

echo "ClassName,MethodName,Time,Status"

xmllint --format "$1" | \
  awk '
    /<testcase/ {
      gsub(/.*classname="/, "", $0);
      class=substr($0, 1, index($0, "\"")-1);
      gsub(/.*name="/, "", $0);
      name=substr($0, 1, index($0, "\"")-1);
      gsub(/.*time="/, "", $0);
      time=substr($0, 1, index($0, "\"")-1);
      status="Pass";
    }
    /<failure/ {
      status="Fail";
    }
    /<\/testcase>/ {
      print class "," name "," time "," status;
    }
  '
