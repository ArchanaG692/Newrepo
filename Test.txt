- name: Convert coverage JSON to CSV
  run: |
    echo "Converting coverage.json to coverage.csv..."

    FILE_PATH="force-app/main/default/lwc/tmpLwcComponent/test/coverage.json"
    CSV_PATH="force-app/main/default/lwc/tmpLwcComponent/test/coverage.csv"

    count=$(jq '.coverage | length' "$FILE_PATH")
    if [ "$count" -gt 0 ]; then
      echo "ClassName,LinesCovered,LinesUncovered,TotalLines" > "$CSV_PATH"
      jq -r '.coverage[] | [.name, .numLinesCovered, .numLinesUncovered, (.numLinesCovered + .numLinesUncovered)] | @csv' "$FILE_PATH" >> "$CSV_PATH"
    else
      echo "No coverage data found."
      echo "ClassName,LinesCovered,LinesUncovered,TotalLines" > "$CSV_PATH"
    fi
