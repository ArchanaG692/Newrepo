tail -n +2 "scanner-report-partial.csv" | \
sed -E ':a; s/("([^"]*,[^"]*)+),/\1|/g; ta' | \
awk -F',' -v OFS=',' \
    -v commit_author="${{ env.GITHUB_USERNAME }}" \
    -v target_branch="${{ env.TARGET_BRANCH }}" \
    -v unwanted_path="$UNWANTED_PATH" '{
  # Fix back the tags column (4th one)
  gsub(/\|/, ",", $4);

  # Ensure columns for commit and target branch
  $11 = commit_author;
  if (NF < 12) $12 = "N/A";
  $13 = target_branch;

  print $0
}' >> scanner-report.csv
